---
layout: post
title: 프로세스(Process)
categories: OS
comments: true
language: ko
---


### 목표
- 프로세스란 무엇인가?
- 프로세스 관리를 위한 프로세스 커널 오브젝트는 어떻게 생성되는가?
- 프로세스 커널 오브젝트가 프로세스를 어떻게 사용하는가?
- 프로세스의 속성과 특성
- 프로세스 관련 함수
- 프로세스를 시스템에서 생성하는 방법


### 프로세스란 무엇인가?

***수행 중인 프로그램의 인스턴스(instance)***
- 프로세스 관리를 위한 프로세스 커널 오브젝트
- 데이터 주소 공간(실행 모듈, DLL, 코드, 스택, 힙 등을 위한)

프로세스는 자력으로 수행될 수 없으며 프로세스가 무언가를 수행하기 우위해서는 반드시 스레드(thread)가 필요하다. 
- 프로세스가 생성되면 스레드 하나를 자동 생성하며 이를 메인 스레드(main thread)라 부른다.
- 하나의 프로세스는 다수의 스레드를 가질 수 있다.
- 스레드들은 프로세스 내부 주소 공간에서 '동시에' 코드를 수행한다.
- 각 스레드는 레지스터 집합과 스택을 갖는다.
- 각 스레드가 동시에 수행될 수 있도록 운영체제는 round-robin 방식으로 CPU 시간 할당 (단일 CPU기준)


**윈도우 애플리케이션의 두 형태**
- GUI(Graphical User Interface)
    - 링커스위치: **/SUBSYSTEM:WINDOWS**
    - 진입 함수: **_tWinMain(WinMain)**
- CUI(Console User Interface)
    - 링커스위치: **/SUBSYSTEM:CONSOLE**
    - 진입 함수: **_tmain(main)**

>링커스위치: 어플리케이션을 수행하면 운영제체의 로더(loader)는 실행 파일의 헤더를 확인하여 서브시스템 값을 가져와서 이 실행파일이 GUI인지 CUI인지를 구분하는데 이 때 사용하는 것.

>진입함수: C/C++의 런타임 시작 함수 이후에 바로 호출될 함수

**프로세스의 실행과 종료** 

운영체제는 어플리케이션을 실행하면 C/C++ 런타임 시작 함수를 호출하고 런타임 시작 함수는 C/C++ 런타임 라이브러리에 대한 초기화를 수행한다.(malloc, free 같은 함수가 실행 가능하도록)
초기화 과정은 기본적으로 다음과 같다.

- 새로운 프로세스의 전체 명령행을 가리키는 포인터 획득
- 새로운 프로세스의 환경 변수를 가리키는 포인터 획득
- C/C++ 런라임 라이브러리의 전역변수를 초기화.
- C/C++ 런타임 라이브러리의 메모리 할당 함수(malloc, free)와 저수준 입력 루틴이 사용할 힙 초기화.
- 모든 전역 오브젝트와 static c++ 클래스 오브젝트들의 생성자 호출.

이러한 초기화 과정 완료 후에 C/C++ 시작 함수는 진입 함수를 호출한다. 진입 함수로부터 프로그래머가 작성한 프로그램의 주 코드가 실행될 것이며 이러한 코드가 실행된 이후에는 c/c++ 런타임 라이브러이의 exit 함수를 호출한다. 이는 다음과 같은 작업을 수행한다.

- _onexit 함수를 이용해 등록된 종료 루틴들을 실행하고
- 모든 전역 클래스 오브젝트와 static c++ 클래스의 소멸자 호출
- ExitProcess() 함수 호출. 이 함수가 호출되면 운영체제는 프로세스를 종료함.


... 작성중